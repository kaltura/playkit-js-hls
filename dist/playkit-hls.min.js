!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("hls.js"),require("playkit-js")):"function"==typeof define&&define.amd?define(["hls.js","playkit-js"],t):"object"==typeof exports?exports.PlaykitJsHls=t(require("hls.js"),require("playkit-js")):e.PlaykitJsHls=t(e.Hls,e.Playkit)}(this,function(e,t){return function(e){function t(i){if(r[i])return r[i].exports;var a=r[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,i){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var n=function e(t,r,i){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,r);if(void 0===a){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,i)}if("value"in a)return a.value;var n=a.get;if(void 0!==n)return n.call(i)},s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=r(1),u=function(e){return e&&e.__esModule?e:{default:e}}(l),c=r(2),d=function(e){function t(e,r,o){i(this,t),t._logger.debug("Creating adapter. Hls version: "+u.default.version);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,o));return n._hls=new u.default(n._config),n._addBindings(),n}return o(t,e),s(t,null,[{key:"createAdapter",value:function(e,t,r){var i={};return c.Utils.Object.hasPropertyPath(r,"playback.options.html5.hls")&&(i=r.playback.options.html5.hls),new this(e,t,i)}},{key:"canPlayType",value:function(e){var r="string"==typeof e&&t._hlsMimeTypes.includes(e.toLowerCase());return t._logger.debug("canPlayType result for mimeType:"+e+" is "+r.toString()),r}},{key:"canPlayDrm",value:function(){return t._logger.warn("canPlayDrm result is false"),!1}},{key:"isSupported",value:function(){var e=u.default.isSupported();return t._logger.debug("isSupported:"+e),e}}]),s(t,[{key:"_addBindings",value:function(){this._hls.on(u.default.Events.ERROR,this._onError.bind(this)),this._hls.on(u.default.Events.MANIFEST_LOADED,this._onManifestLoaded.bind(this)),this._hls.on(u.default.Events.LEVEL_SWITCHED,this._onLevelSwitched.bind(this)),this._hls.on(u.default.Events.AUDIO_TRACK_SWITCHED,this._onAudioTrackSwitched.bind(this))}},{key:"load",value:function(e){var t=this;return this._loadPromise||(this._loadPromise=new Promise(function(r){var i=function e(){t._hls.off(u.default.Events.LEVEL_UPDATED,e),r({tracks:t._playerTracks})};t._hls.on(u.default.Events.LEVEL_UPDATED,i),e&&(t._hls.startPosition=e),t._sourceObj&&t._sourceObj.url&&(t._hls.loadSource(t._sourceObj.url),t._hls.attachMedia(t._videoElement),t._trigger(c.BaseMediaSourceAdapter.CustomEvents.ABR_MODE_CHANGED,{mode:t.isAdaptiveBitrateEnabled()?"auto":"manual"}))})),this._loadPromise}},{key:"destroy",value:function(){var e=this;return n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this).then(function(){t._logger.debug("destroy"),e._loadPromise=null,e._removeBindings(),e._hls.detachMedia(),e._hls.destroy()})}},{key:"_parseTracks",value:function(e){var t=this._parseAudioTracks(e.audioTracks||[]),r=this._parseVideoTracks(e.levels||[]),i=this._parseTextTracks(this._videoElement.textTracks||[]);return t.concat(r).concat(i)}},{key:"_parseAudioTracks",value:function(e){for(var t=[],r=0;r<e.length;r++){var i={id:e[r].id,active:this._hls.audioTrack===e[r].id,label:e[r].name,language:e[r].lang,index:r};t.push(new c.AudioTrack(i))}return t}},{key:"_parseVideoTracks",value:function(e){for(var t=[],r=0;r<e.length;r++){var i={active:this._hls.startLevel===r,label:e[r].name,bandwidth:e[r].bitrate,width:e[r].width,height:e[r].height,language:"",index:r};t.push(new c.VideoTrack(i))}return t}},{key:"_parseTextTracks",value:function(e){for(var t=[],r=0;r<e.length;r++){var i={active:"showing"===e[r].mode,label:e[r].label,kind:e[r].kind,language:e[r].language,index:r};t.push(new c.TextTrack(i))}return t}},{key:"selectAudioTrack",value:function(e){e instanceof c.AudioTrack&&!e.active&&this._hls.audioTracks&&(this._hls.audioTrack=e.id)}},{key:"selectVideoTrack",value:function(e){e instanceof c.VideoTrack&&(!e.active||this.isAdaptiveBitrateEnabled())&&this._hls.levels&&(this.isAdaptiveBitrateEnabled()&&this._trigger(c.BaseMediaSourceAdapter.CustomEvents.ABR_MODE_CHANGED,{mode:"manual"}),this._hls.currentLevel=e.index)}},{key:"selectTextTrack",value:function(e){e instanceof c.TextTrack&&!e.active&&this._videoElement.textTracks&&(this._disableAllTextTracks(),this._videoElement.textTracks[e.index].mode="hidden",t._logger.debug("Text track changed",e),this._onTrackChanged(e))}},{key:"hideTextTrack",value:function(){this._disableAllTextTracks()}},{key:"enableAdaptiveBitrate",value:function(){this.isAdaptiveBitrateEnabled()||(this._trigger(c.BaseMediaSourceAdapter.CustomEvents.ABR_MODE_CHANGED,{mode:"auto"}),this._hls.nextLevel=-1)}},{key:"isAdaptiveBitrateEnabled",value:function(){return this._hls.autoLevelEnabled}},{key:"_getLiveEdge",value:function(){try{var e=void 0;return e=this._hls.config.liveSyncDuration?this._videoElement.duration-this._hls.config.liveSyncDuration:this._videoElement.duration-this._hls.config.liveSyncDurationCount*this._hls.levels[0].details.targetduration,e>0?e:0}catch(e){return NaN}}},{key:"seekToLiveEdge",value:function(){try{this._videoElement.currentTime=this._getLiveEdge()}catch(e){return}}},{key:"isLive",value:function(){try{return this._hls.levels[0].details.live}catch(e){return!1}}},{key:"_onManifestLoaded",value:function(e,r){t._logger.debug("The source has been loaded successfully"),this._hls.startLoad(),this._playerTracks=this._parseTracks(r)}},{key:"_onLevelSwitched",value:function(e,r){var i=this._playerTracks.find(function(e){return e instanceof c.VideoTrack&&e.index===r.level});t._logger.debug("Video track changed",i),this._onTrackChanged(i)}},{key:"_onAudioTrackSwitched",value:function(e,r){var i=this._playerTracks.find(function(e){return e instanceof c.AudioTrack&&e.id===r.id});t._logger.debug("Audio track changed",i),this._onTrackChanged(i)}},{key:"_disableAllTextTracks",value:function(){for(var e=this._videoElement.textTracks,t=0;t<e.length;t++)e[t].mode="disabled"}},{key:"_onError",value:function(e,r){var i=r.type,a=r.details;if(r.fatal)switch(i){case u.default.ErrorTypes.NETWORK_ERROR:t._logger.error("fatal network error encountered, try to recover"),this._hls.startLoad();break;case u.default.ErrorTypes.MEDIA_ERROR:t._logger.error("fatal media error encountered, try to recover"),this._hls.recoverMediaError();break;default:t._logger.error("fatal error, cannot recover"),this.destroy()}else switch(a){case u.default.ErrorDetails.MANIFEST_LOAD_ERROR:case u.default.ErrorDetails.MANIFEST_LOAD_TIMEOUT:case u.default.ErrorDetails.MANIFEST_PARSING_ERROR:case u.default.ErrorDetails.LEVEL_LOAD_ERROR:case u.default.ErrorDetails.LEVEL_LOAD_TIMEOUT:case u.default.ErrorDetails.LEVEL_SWITCH_ERROR:case u.default.ErrorDetails.FRAG_LOAD_ERROR:case u.default.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case u.default.ErrorDetails.FRAG_LOAD_TIMEOUT:case u.default.ErrorDetails.FRAG_PARSING_ERROR:case u.default.ErrorDetails.BUFFER_APPEND_ERROR:case u.default.ErrorDetails.BUFFER_APPENDING_ERROR:t._logger.error(i,a)}}},{key:"_removeBindings",value:function(){this._hls.off(u.default.Events.ERROR,this._onError),this._hls.off(u.default.Events.LEVEL_SWITCHED,this._onLevelSwitched),this._hls.off(u.default.Events.AUDIO_TRACK_SWITCHED,this._onAudioTrackSwitched)}},{key:"src",get:function(){return this._loadPromise&&this._sourceObj?this._sourceObj.url:""}},{key:"duration",get:function(){return this.isLive()?this._getLiveEdge():n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"duration",this)}}]),t}(c.BaseMediaSourceAdapter);d.id="HlsAdapter",d._logger=c.BaseMediaSourceAdapter.getLogger(d.id),d._hlsMimeTypes=["application/x-mpegurl","application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"],t.default=d,d.isSupported()&&(0,c.registerMediaSourceAdapter)(d)},function(t,r){t.exports=e},function(e,r){e.exports=t}])});
//# sourceMappingURL=playkit-hls.min.js.map